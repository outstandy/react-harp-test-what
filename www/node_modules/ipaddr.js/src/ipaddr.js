var expandIPv6,ipaddr,ipv4Part,ipv4Regexes,ipv6Part,ipv6Regexes,matchCIDR,root;ipaddr={};root=this;if(typeof module!=="undefined"&&module!==null&&module.exports){module.exports=ipaddr}else{root["ipaddr"]=ipaddr}matchCIDR=function(r,t,e,i){var n,a;if(r.length!==t.length){throw new Error("ipaddr: cannot match CIDR for objects with different lengths")}n=0;while(i>0){a=e-i;if(a<0){a=0}if(r[n]>>a!==t[n]>>a){return false}i-=e;n+=1}return true};ipaddr.subnetMatch=function(r,t,e){var i,n,a,p,s;if(e==null){e="unicast"}for(a in t){p=t[a];if(p[0]&&!(p[0]instanceof Array)){p=[p]}for(i=0,n=p.length;i<n;i++){s=p[i];if(r.match.apply(r,s)){return a}}}return e};ipaddr.IPv4=function(){function r(r){var t,e,i;if(r.length!==4){throw new Error("ipaddr: ipv4 octet count should be 4")}for(t=0,e=r.length;t<e;t++){i=r[t];if(!(0<=i&&i<=255)){throw new Error("ipaddr: ipv4 octet should fit in 8 bits")}}this.octets=r}r.prototype.kind=function(){return"ipv4"};r.prototype.toString=function(){return this.octets.join(".")};r.prototype.toByteArray=function(){return this.octets.slice(0)};r.prototype.match=function(r,t){var e;if(t===void 0){e=r,r=e[0],t=e[1]}if(r.kind()!=="ipv4"){throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one")}return matchCIDR(this.octets,r.octets,8,t)};r.prototype.SpecialRanges={unspecified:[[new r([0,0,0,0]),8]],broadcast:[[new r([255,255,255,255]),32]],multicast:[[new r([224,0,0,0]),4]],linkLocal:[[new r([169,254,0,0]),16]],loopback:[[new r([127,0,0,0]),8]],"private":[[new r([10,0,0,0]),8],[new r([172,16,0,0]),12],[new r([192,168,0,0]),16]],reserved:[[new r([192,0,0,0]),24],[new r([192,0,2,0]),24],[new r([192,88,99,0]),24],[new r([198,51,100,0]),24],[new r([203,0,113,0]),24],[new r([240,0,0,0]),4]]};r.prototype.range=function(){return ipaddr.subnetMatch(this,this.SpecialRanges)};r.prototype.toIPv4MappedAddress=function(){return ipaddr.IPv6.parse("::ffff:"+this.toString())};r.prototype.prefixLengthFromSubnetMask=function(){var r,t,e,i,n,a,p;p={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};r=0;n=false;for(t=e=3;e>=0;t=e+=-1){i=this.octets[t];if(i in p){a=p[i];if(n&&a!==0){return null}if(a!==8){n=true}r+=a}else{return null}}return 32-r};return r}();ipv4Part="(0?\\d+|0x[a-f0-9]+)";ipv4Regexes={fourOctet:new RegExp("^"+ipv4Part+"\\."+ipv4Part+"\\."+ipv4Part+"\\."+ipv4Part+"$","i"),longValue:new RegExp("^"+ipv4Part+"$","i")};ipaddr.IPv4.parser=function(r){var t,e,i,n,a;e=function(r){if(r[0]==="0"&&r[1]!=="x"){return parseInt(r,8)}else{return parseInt(r)}};if(t=r.match(ipv4Regexes.fourOctet)){return function(){var r,n,a,p;a=t.slice(1,6);p=[];for(r=0,n=a.length;r<n;r++){i=a[r];p.push(e(i))}return p}()}else if(t=r.match(ipv4Regexes.longValue)){a=e(t[1]);if(a>4294967295||a<0){throw new Error("ipaddr: address outside defined range")}return function(){var r,t;t=[];for(n=r=0;r<=24;n=r+=8){t.push(a>>n&255)}return t}().reverse()}else{return null}};ipaddr.IPv6=function(){function r(r){var t,e,i,n,a,p;if(r.length===16){this.parts=[];for(t=e=0;e<=14;t=e+=2){this.parts.push(r[t]<<8|r[t+1])}}else if(r.length===8){this.parts=r}else{throw new Error("ipaddr: ipv6 part count should be 8 or 16")}p=this.parts;for(i=0,n=p.length;i<n;i++){a=p[i];if(!(0<=a&&a<=65535)){throw new Error("ipaddr: ipv6 part should fit in 16 bits")}}}r.prototype.kind=function(){return"ipv6"};r.prototype.toString=function(){var r,t,e,i,n,a,p;p=function(){var r,t,e,n;e=this.parts;n=[];for(r=0,t=e.length;r<t;r++){i=e[r];n.push(i.toString(16))}return n}.call(this);r=[];n=function(t){return r.push(t)};a=0;for(t=0,e=p.length;t<e;t++){i=p[t];switch(a){case 0:if(i==="0"){n("")}else{n(i)}a=1;break;case 1:if(i==="0"){a=2}else{n(i)}break;case 2:if(i!=="0"){n("");n(i);a=3}break;case 3:n(i)}}if(a===2){n("");n("")}return r.join(":")};r.prototype.toByteArray=function(){var r,t,e,i,n;r=[];n=this.parts;for(t=0,e=n.length;t<e;t++){i=n[t];r.push(i>>8);r.push(i&255)}return r};r.prototype.toNormalizedString=function(){var r;return function(){var t,e,i,n;i=this.parts;n=[];for(t=0,e=i.length;t<e;t++){r=i[t];n.push(r.toString(16))}return n}.call(this).join(":")};r.prototype.match=function(r,t){var e;if(t===void 0){e=r,r=e[0],t=e[1]}if(r.kind()!=="ipv6"){throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one")}return matchCIDR(this.parts,r.parts,16,t)};r.prototype.SpecialRanges={unspecified:[new r([0,0,0,0,0,0,0,0]),128],linkLocal:[new r([65152,0,0,0,0,0,0,0]),10],multicast:[new r([65280,0,0,0,0,0,0,0]),8],loopback:[new r([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new r([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new r([0,0,0,0,0,65535,0,0]),96],rfc6145:[new r([0,0,0,0,65535,0,0,0]),96],rfc6052:[new r([100,65435,0,0,0,0,0,0]),96],"6to4":[new r([8194,0,0,0,0,0,0,0]),16],teredo:[new r([8193,0,0,0,0,0,0,0]),32],reserved:[[new r([8193,3512,0,0,0,0,0,0]),32]]};r.prototype.range=function(){return ipaddr.subnetMatch(this,this.SpecialRanges)};r.prototype.isIPv4MappedAddress=function(){return this.range()==="ipv4Mapped"};r.prototype.toIPv4Address=function(){var r,t,e;if(!this.isIPv4MappedAddress()){throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4")}e=this.parts.slice(-2),r=e[0],t=e[1];return new ipaddr.IPv4([r>>8,r&255,t>>8,t&255])};return r}();ipv6Part="(?:[0-9a-f]+::?)+";ipv6Regexes={"native":new RegExp("^(::)?("+ipv6Part+")?([0-9a-f]+)?(::)?$","i"),transitional:new RegExp("^((?:"+ipv6Part+")|(?:::)(?:"+ipv6Part+")?)"+(ipv4Part+"\\."+ipv4Part+"\\."+ipv4Part+"\\."+ipv4Part+"$"),"i")};expandIPv6=function(r,t){var e,i,n,a,p;if(r.indexOf("::")!==r.lastIndexOf("::")){return null}e=0;i=-1;while((i=r.indexOf(":",i+1))>=0){e++}if(r.substr(0,2)==="::"){e--}if(r.substr(-2,2)==="::"){e--}if(e>t){return null}p=t-e;a=":";while(p--){a+="0:"}r=r.replace("::",a);if(r[0]===":"){r=r.slice(1)}if(r[r.length-1]===":"){r=r.slice(0,-1)}return function(){var t,e,i,a;i=r.split(":");a=[];for(t=0,e=i.length;t<e;t++){n=i[t];a.push(parseInt(n,16))}return a}()};ipaddr.IPv6.parser=function(r){var t,e,i,n,a,p;if(r.match(ipv6Regexes["native"])){return expandIPv6(r,8)}else if(i=r.match(ipv6Regexes["transitional"])){p=expandIPv6(i[1].slice(0,-1),6);if(p){a=[parseInt(i[2]),parseInt(i[3]),parseInt(i[4]),parseInt(i[5])];for(t=0,e=a.length;t<e;t++){n=a[t];if(!(0<=n&&n<=255)){return null}}p.push(a[0]<<8|a[1]);p.push(a[2]<<8|a[3]);return p}}return null};ipaddr.IPv4.isIPv4=ipaddr.IPv6.isIPv6=function(r){return this.parser(r)!==null};ipaddr.IPv4.isValid=function(r){var t,e;try{new this(this.parser(r));return true}catch(e){t=e;return false}};ipaddr.IPv6.isValid=function(r){var t,e;if(typeof r==="string"&&r.indexOf(":")===-1){return false}try{new this(this.parser(r));return true}catch(e){t=e;return false}};ipaddr.IPv4.parse=ipaddr.IPv6.parse=function(r){var t;t=this.parser(r);if(t===null){throw new Error("ipaddr: string is not formatted like ip address")}return new this(t)};ipaddr.IPv4.parseCIDR=function(r){var t,e;if(e=r.match(/^(.+)\/(\d+)$/)){t=parseInt(e[2]);if(t>=0&&t<=32){return[this.parse(e[1]),t]}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")};ipaddr.IPv6.parseCIDR=function(r){var t,e;if(e=r.match(/^(.+)\/(\d+)$/)){t=parseInt(e[2]);if(t>=0&&t<=128){return[this.parse(e[1]),t]}}throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")};ipaddr.isValid=function(r){return ipaddr.IPv6.isValid(r)||ipaddr.IPv4.isValid(r)};ipaddr.parse=function(r){if(ipaddr.IPv6.isValid(r)){return ipaddr.IPv6.parse(r)}else if(ipaddr.IPv4.isValid(r)){return ipaddr.IPv4.parse(r)}else{throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")}};ipaddr.parseCIDR=function(r){var t,e,i;try{return ipaddr.IPv6.parseCIDR(r)}catch(e){t=e;try{return ipaddr.IPv4.parseCIDR(r)}catch(i){t=i;throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}};ipaddr.fromByteArray=function(r){var t;t=r.length;if(t===4){return new ipaddr.IPv4(r)}else if(t===16){return new ipaddr.IPv6(r)}else{throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")}};ipaddr.process=function(r){var t;t=this.parse(r);if(t.kind()==="ipv6"&&t.isIPv4MappedAddress()){return t.toIPv4Address()}else{return t}};