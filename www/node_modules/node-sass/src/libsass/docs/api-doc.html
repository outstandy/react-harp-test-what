<!DOCTYPE html><html><title>Hometown</title><link rel="stylesheet" href="/scss/main.css"><script src="https://fb.me/react-0.14.7.js"></script><script src="https://fb.me/react-dom-0.14.7.js"></script><script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script><script src="https://npmcdn.com/jquery@3.1.0/dist/jquery.min.js"></script><script src="https://npmcdn.com/remarkable@1.6.2/dist/remarkable.min.js"></script><body><nav><div class="grid"><div class="row"><div class="grid-1-1"><a href="#" class="titling type-300 pink">Hometown</a></div></div></div></nav><h2>Introduction</h2><p>LibSass wouldn&#39;t be much good without a way to interface with it. These interface documentations describe the various functions and data structures available to implementers. They are split up over three major components, which have all their own source files (plus some common functionality).</p>
<ul>
<li><a href="api-context.md">Sass Context</a> - Trigger and handle the main Sass compilation</li>
<li><a href="api-value.md">Sass Value</a> - Exchange values and its format with LibSass</li>
<li><a href="api-function.md">Sass Function</a> - Get invoked by LibSass for function statments</li>
<li><a href="api-importer.md">Sass Importer</a> - Get invoked by LibSass for @import statments</li>
</ul>
<h3>Basic usage</h3><p>First you will need to include the header file!
This will automatically load all other headers too!</p>
<pre><code class="language-C">#include &quot;sass/context.h&quot;
</code></pre>
<h2>Basic C Example</h2><pre><code class="language-C">#include &lt;stdio.h&gt;
#include &quot;sass/context.h&quot;

int main() {
  puts(libsass_version());
  return 0;
}
</code></pre>
<pre><code class="language-bash">gcc -Wall version.c -lsass -o version &amp;&amp; ./version
</code></pre>
<h2>More C Examples</h2><ul>
<li><a href="api-context-example.md">Sample code for Sass Context</a></li>
<li><a href="api-value-example.md">Sample code for Sass Value</a></li>
<li><a href="api-function-example.md">Sample code for Sass Function</a></li>
<li><a href="api-importer-example.md">Sample code for Sass Importer</a></li>
</ul>
<h2>Compiling your code</h2><p>The most important is your sass file (or string of sass code).  With this, you will want to start a LibSass compiler.  Here is some pseudocode describing the process.  The compiler has two different modes: direct input as a string with <code>Sass_Data_Context</code> or LibSass will do file reading for you by using <code>Sass_File_Context</code>.  See the code for a list of options available <a href="https://github.com/sass/libsass/blob/36feef0/include/sass/interface.h#L18">Sass_Options</a></p>
<p><strong>Building a file compiler</strong></p>
<pre><code>context = sass_make_file_context(&quot;file.scss&quot;)
options = sass_file_context_get_options(context)
sass_option_set_precision(options, 1)
sass_option_set_source_comments(options, true)

sass_file_context_set_options(context, options)

compiler = sass_make_file_compiler(sass_context)
sass_compiler_parse(compiler)
sass_compiler_execute(compiler)

output = sass_context_get_output_string(context)
// Retrieve errors during compilation
error_status = sass_context_get_error_status(context)
json_error = sass_context_get_error_json(context)
// Release memory dedicated to the C compiler
sass_delete_compiler(compiler)
</code></pre><p><strong>Building a data compiler</strong></p>
<pre><code>context = sass_make_data_context(&quot;div { a { color: blue; } }&quot;)
options = sass_data_context_get_options(context)
sass_option_set_precision(options, 1)
sass_option_set_source_comments(options, true)

sass_data_context_set_options(context, options)

compiler = sass_make_data_compiler(context)
sass_compiler_parse(compiler)
sass_compiler_execute(compiler)

output = sass_context_get_output_string(context)
// div a { color: blue; }
// Retrieve errors during compilation
error_status = sass_context_get_error_status(context)
json_error = sass_context_get_error_json(context)
// Release memory dedicated to the C compiler
sass_delete_compiler(compiler)
</code></pre><h2>Sass Context Internals</h2><p>Everything is stored in structs:</p>
<pre><code class="language-C">struct Sass_Options;
struct Sass_Context : Sass_Options;
struct Sass_File_context : Sass_Context;
struct Sass_Data_context : Sass_Context;
</code></pre>
<p>This mirrors very well how <code>libsass</code> uses these structures.</p>
<ul>
<li><code>Sass_Options</code> holds everything you feed in before the compilation. It also hosts <code>input_path</code> and <code>output_path</code> options, because they are used to generate/calculate relative links in source-maps. The <code>input_path</code> is shared with <code>Sass_File_Context</code>.</li>
<li><code>Sass_Context</code> holds all the data returned by the compilation step.</li>
<li><code>Sass_File_Context</code> is a specific implementation that requires no additional fields</li>
<li><code>Sass_Data_Context</code> is a specific implementation that adds the <code>input_source</code> field</li>
</ul>
<p>Structs can be down-casted to access <code>context</code> or <code>options</code>!</p>
<h2>Memory handling and life-cycles</h2><p>We keep memory around for as long as the main <a href="api-context.md">context</a> object is not destroyed (<code>sass_delete_context</code>). LibSass will create copies of most inputs/options beside the main sass code.
You need to allocate and fill that buffer before passing it to LibSass. You may also overtake memory management from libsass for certain return values (i.e. <code>sass_context_take_output_string</code>).</p>
<pre><code class="language-C">// to allocate buffer to be filled
void* sass_alloc_memory(size_t size);
// to allocate a buffer from existing string
char* sass_copy_c_string(const char* str);
// to free overtaken memory when done
void sass_free_memory(void* ptr);
</code></pre>
<h2>Miscellaneous API functions</h2><pre><code class="language-C">// Some convenient string helper function
char* sass_string_unquote (const char* str);
char* sass_string_quote (const char* str, const char quote_mark);

// Resolve a file via the given include paths in the include char* array
char* sass_resolve_file (const char* path, const char* incs[]);

// Get compiled libsass version
const char* libsass_version(void);
</code></pre>
<h2>Common Pitfalls</h2><p><strong>input_path</strong></p>
<p>The <code>input_path</code> is part of <code>Sass_Options</code>, but it also is the main option for <code>Sass_File_Context</code>. It is also used to generate relative file links in source-maps. Therefore it is pretty usefull to pass this information if you have a <code>Sass_Data_Context</code> and know the original path.</p>
<p><strong>output_path</strong></p>
<p>Be aware that <code>libsass</code> does not write the output file itself. This option merely exists to give <code>libsass</code> the proper information to generate links in source-maps. The file has to be written to the disk by the binding/implementation. If the <code>output_path</code> is omitted, <code>libsass</code> tries to extrapolate one from the <code>input_path</code> by replacing (or adding) the file ending with <code>.css</code>.</p>
<h2>Error Codes</h2><p>The <code>error_code</code> is integer value which indicates the type of error that occurred inside the LibSass process. Following is the list of error codes along with the short description:</p>
<ul>
<li>1: normal errors like parsing or <code>eval</code> errors</li>
<li>2: bad allocation error (memory error)</li>
<li>3: &quot;untranslated&quot; C++ exception (<code>throw std::exception</code>)</li>
<li>4: legacy string exceptions ( <code>throw const char*</code> or <code>std::string</code> )</li>
<li>5: Some other unknown exception</li>
</ul>
<p>Although for the API consumer, error codes do not offer much value except indicating whether <em>any</em> error occurred during the compilation, it helps debugging the LibSass internal code paths.</p>
<h2>Real-World Implementations</h2><p>The proof is in the pudding, so we have highlighted a few implementations that should be on par with the latest LibSass interface version. Some of them may not have all features implemented!</p>
<ol>
<li><a href="https://github.com/sass/perl-libsass/blob/master/lib/CSS/Sass.xs">Perl Example</a></li>
<li><a href="http://godoc.org/github.com/wellington/go-libsass#example-Context-Compile">Go Example</a></li>
<li><a href="https://github.com/sass/node-sass/blob/master/src/binding.cpp">Node Example</a></li>
</ol>
<h2>ABI forward compatibility</h2><p>We use a functional API to make dynamic linking more robust and future compatible. The API is not yet 100% stable, so we do not yet guarantee <a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/abi.html">ABI</a> forward compatibility. We will do so, once we increase the shared library version above 1.0.</p>
<h2>Plugins (experimental)</h2><p>LibSass can load plugins from directories. Just define <code>plugin_path</code> on context options to load all plugins from the given directories. To implement plugins, please consult the [[Wiki-Page for plugins|API-Plugins]].</p>
<h2>Internal Structs</h2><ul>
<li><a href="api-context-internal.md">Sass Context Internals</a></li>
<li><a href="api-value-internal.md">Sass Value Internals</a></li>
<li><a href="api-function-internal.md">Sass Function Internals</a></li>
<li><a href="api-importer-internal.md">Sass Importer Internals</a></li>
</ul><footer><div class="grid"><div class="row"><div class="grid-1-1"><p class="text off-white">This the footer</p></div></div></div></footer><script src="bundle.js"></script></body></html>